=====================
Лабораторна робота №5
=====================

Завдання:
---------

Написати та протестувати власний модуль ядра, який:
  * принимает аргументы th_val, wrk_val и jffdelay, реализует два потока и ворк (в дефолтном work queue), а также таймер (на базе timer wheel)
  * Запускает таймер и ворк
  * При срабатывании таймера проверяет текущее значение jiffies, если оно кратно th_val – остановить первый поток; иначе – таймер перезапускается через jffdelay jiffies
  * Внутри ворка проверяет текущее значение jiffies, если оно кратно wrk_val – остановить второй поток; иначе – ворк должен уснуть на jffdelay jiffies и перезапустить себя.
  * Проверить работу. Для th_val и wrk_val желательно выбирать простые числа
  * Добавить два связных списка, в которые аллоцировать и добавлять элементы со значениями jiffies которые не привели к завершению первого и второго потоков соответственно. Получается связь "таймер – 1й список – 1й поток" и  "ворк – 2й список – 2й поток"
  * При выходе из потока распечатать список
  * Внутри ворка и таймера использовать правильные аллокации для новых элементов списка, правильную синхронизацию доступа к списку
  * Предусмотреть, что пользователь может выгрузить модуль досрочно
 
Хід роботи
----------
З початку було зроблено спробу реалізувати завершення потоків через completions але пілся відпрацювання exit функ

Результати
----------

перший рядок параметри виклику insmod подалші рядки відпрацювання exit вункції ядро ламалось. тому було вирішено зроьити реалізацію через прапорці.

результат відпрацювання:

.. code-block:: bash

	/ # insmod mnt/delayed.ko th_val=3 wrk_val=7 jiff_delay=8
	[   16.788528] delayed: loading out-of-tree module taints kernel.
	[   16.822599] 162
	[   16.822859] 187
	[   16.823741] 195
	[   16.829323] 209
	[   16.833554] 216
	[   16.850649] insmod (96) used greatest stack depth: 13696 bytest
	/ # [   16.899533] work_thread is going to be finished
	[   16.899533] list of odd jiffies:
	[   16.901905] <----->>work jiffies = 4294684166!!!!!
	[   16.903272] <----->>work jiffies = 4294684195!!!!!
	[   16.904125] <----->>work jiffies = 4294684210!!!!!
	[   16.968257] timer_thread is going to be finished
	[   16.968257] list of odd jiffies:
	[   16.972204] <----->>timer jiffies = 4294684163!!!!!
	[   16.974896] <----->>timer jiffies = 4294684186!!!!!
	[   16.976647] <----->>timer jiffies = 4294684195!!!!!
	[   16.978824] <----->>timer jiffies = 4294684210!!!!!
	[   16.984947] <----->>timer jiffies = 4294684219!!!!!
	[   16.986914] <----->>timer jiffies = 4294684228!!!!!
	[   16.991286] <----->>timer jiffies = 4294684240!!!!!
	[   16.993336] <----->>timer jiffies = 4294684249!!!!!
	[   16.993935] <----->>timer jiffies = 4294684258!!!!!
	[   17.000146] <----->>timer jiffies = 4294684268!!!!!
	[   17.000606] <----->>timer jiffies = 4294684277!!!!!


	
Висновки
--------
під час виконання лабораторної роботи було виконано щось подібне до completions на базі прапорців і отримані результати було складно читати через те що потоки
1 та 2 виводизи результати роботи із списків конкурентно тому було прийнято рішення додати синхронізацію виводу за допомогою mutex.
